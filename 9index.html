<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Android AI</title>
    <meta name="theme-color" content="#4285F4">
    
    <script>
        const manifest = {
            "name": "Android Gemini Nano",
            "short_name": "My AI",
            "start_url": ".",
            "display": "standalone",
            "background_color": "#ffffff",
            "theme_color": "#4285F4",
            "icons": [{ "src": "https://via.placeholder.com/192", "sizes": "192x192", "type": "image/png" }]
        };
        const blob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
        const link = document.createElement('link');
        link.rel = 'manifest';
        link.href = URL.createObjectURL(blob);
        document.head.appendChild(link);
    </script>

    <style>
        body { font-family: sans-serif; background: #f4f4f9; display: flex; flex-direction: column; height: 100vh; margin: 0; }
        #chat-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px 15px; border-radius: 18px; max-width: 80%; font-size: 15px; }
        .user { align-self: flex-end; background: #4285F4; color: white; }
        .ai { align-self: flex-start; background: #e8eaed; color: #202124; }
        #input-container { padding: 15px; background: white; display: flex; gap: 10px; border-top: 1px solid #ddd; }
        input { flex: 1; padding: 12px; border-radius: 25px; border: 1px solid #ccc; outline: none; }
        button { background: #4285F4; color: white; border: none; padding: 10px 20px; border-radius: 25px; font-weight: bold; }
        #flag-btn { position: fixed; top: 10px; right: 10px; font-size: 12px; opacity: 0.7; }
    </style>
</head>
<body>

    <button id="flag-btn" onclick="copyFlag()">üõ†Ô∏è Setup Flags</button>

    <div id="chat-area">
        <div class="msg ai">Hi! Once your Android flags are set, I'm ready to chat.</div>
    </div>

    <div id="input-container">
        <input type="text" id="user-input" placeholder="Type to Android AI...">
        <button onclick="askAI()">Send</button>
    </div>

    <script>
        // 1. Android Flags Shortcut
        function copyFlag() {
            navigator.clipboard.writeText("optimization-guide-on-device-model");
            alert("1. Flag name copied!\n2. Go to chrome://flags\n3. Enable '#optimization-guide-on-device-model'\n4. Enable '#prompt-api-for-gemini-nano'\n5. Relaunch Chrome.");
        }

        // 2. Gemini Nano AI Logic
        async function askAI() {
            const inputField = document.getElementById('user-input');
            const chatArea = document.getElementById('chat-area');
            const text = inputField.value.trim();
            if (!text) return;

            // Add User Message
            const userMsg = document.createElement('div');
            userMsg.className = 'msg user';
            userMsg.innerText = text;
            chatArea.appendChild(userMsg);
            inputField.value = "";

            // Prepare AI Message
            const aiMsg = document.createElement('div');
            aiMsg.className = 'msg ai';
            aiMsg.innerText = "Checking AI...";
            chatArea.appendChild(aiMsg);
            chatArea.scrollTop = chatArea.scrollHeight;

            try {
                if (!window.ai || !window.ai.languageModel) {
                    throw new Error("AI API not found. Please enable flags.");
                }
                
                const session = await window.ai.languageModel.create();
                const stream = session.promptStreaming(text);
                
                for await (const chunk of stream) {
                    aiMsg.innerText = chunk;
                    chatArea.scrollTop = chatArea.scrollHeight;
                }
            } catch (err) {
                aiMsg.innerText = "Error: " + err.message;
            }
        }

        // 3. PWA Install Logic
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            const installBtn = document.createElement('button');
            installBtn.innerText = "Install App";
            installBtn.style = "position:fixed; bottom:80px; left:50%; transform:translateX(-50%); z-index:100;";
            document.body.appendChild(installBtn);
            installBtn.onclick = () => { e.prompt(); installBtn.remove(); };
        });
    </script>
</body>
</html>
